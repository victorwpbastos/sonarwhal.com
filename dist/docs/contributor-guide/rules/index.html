<!doctype html><html lang="en"><head><meta charset="utf-8"><title>How to develop a rule | sonar documentation</title><meta property="og:image" content="/images/apple-touch-icon.png"><meta property="og:description" content="All the things to take into account if you are going to develop a new rule"><meta property="og:title" content="How to develop a rule"><meta name="description" content="All the things to take into account if you are going to develop a new rule"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#4046dd"><link rel="manifest" href="/site.webmanifest"><link rel="apple-touch-icon" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16"><link rel="stylesheet" href="/core/css/about.css"><link rel="stylesheet" href="/core/css/base.css"><link rel="stylesheet" href="/core/css/color.css"><link rel="stylesheet" href="/core/css/footer.css"><link rel="stylesheet" href="/core/css/helpers.css"><link rel="stylesheet" href="/core/css/layouts.css"><link rel="stylesheet" href="/core/css/media.css"><link rel="stylesheet" href="/core/css/navigation.css"><link rel="stylesheet" href="/core/css/search-results.css"><link rel="stylesheet" href="/core/css/structure.css"><link rel="stylesheet" href="/core/css/type.css"><link rel="stylesheet" href="/core/css/highlight.css"><link rel="stylesheet" href="/components/breadcrumb/breadcrumb.css"><link rel="stylesheet" href="/components/pagination/pagination.css"><link rel="stylesheet" href="/core/css/controls.css"><link rel="stylesheet" href="/core/css/scanner.css"><link href="https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"><link rel="stylesheet" href="/core/css/code.css"><link rel="stylesheet" href="/core/css/table-of-contents.css"><link rel="stylesheet" href="/core/css/tables-lists.css"><link rel="stylesheet" href="/components/treeview/treeview.css"><link rel="stylesheet" href="/core/css/documentation.css"></head><body><header class="header"><div class="nav-bar container"><nav class="nav"><a href="/" class="clear logo--container"><img src="/images/sonar-logo.svg" alt="sonar" class="header__logo navbar__navitem"></a><ul class="nav__navbar"><li class="navbar__navitem"><a role="button" href="/scanner/" id="scanner" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-scanner" class="navitem__button">Scanner</a></li><li class="navbar__navitem"><a role="button" href="/docs/" id="docs" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-docs" class="navitem__button expandable">Documentation</a><ul role="group" id="submenu-docs" class="navbar__submenu" aria-hidden="true"><li><a href="/docs/contributor-guide/">Contributor Guide</a></li><li><a href="/docs/user-guide/rules/">Rules</a></li><li><a href="/docs/user-guide/">User Guide</a></li></ul></li><li class="navbar__navitem"><a role="button" href="/about/" id="about" aria-haspopup="true" aria-expanded="false" aria-controls="submenu-about" class="navitem__button expandable">About</a><ul role="group" id="submenu-about" class="navbar__submenu" aria-hidden="true"><li><a href="/about/faq/">FAQ</a></li><li><a href="/about/changelog/">Changelog</a></li><li><a href="/about/governance/">Governance</a></li><li><a href="/about/contributors/">Contributors</a></li><li><a href="https://js.foundation/community/code-of-conduct">Code of Conduct</a></li></ul></li></ul><div class="nav-bar__input"><form action="/search" method="GET"><label for="search-input" class="visually-hidden">Search the documentation</label><input type="search" id="search-input" placeholder="Search…" name="q" aria-label="Search"></form></div></nav><button class="header__toggle mobile-nav-button" aria-label="Menu"></button></div></header><main class="container"><article class="content" aria-labelledby="page-heading"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/">Home</a></li><li><a href="../../">Documentation</a></li><li><a href="../" class="guide-category">Contributor guide</a></li><li aria-current="location">How to develop a rule</li></ul></nav><header class="page-intro"><h1 id="page-heading">How to develop a rule</h1><div class="documentation-actions"><ul><li><a target="_blank" href="https://github.com/sonarwhal/sonar/blob/master/docs/contributor-guide/rules/index.md">Edit</a></li><li><a target="_blank" href="https://github.com/sonarwhal/sonar/issues/new?title&#x3D;%5Bdocs%5D%20Issue%20with%20&#x27;How%20to%20develop%20a%20rule&#x27;&amp;body&#x3D;https%3A%2F%2Fsonarwhal.com%2Fdocs%2Fcontributor-guide%2Frules%2Findex.html">Signal Issue</a></li></ul></div></header><div class="section"><div class="layout layout--sidebar"><div class="module module--primary wrap-text"><h1 id="howtodeveloparule">How to develop a rule<a href="#howtodeveloparule" class="headerlink" title="How to develop a rule"></a></h1><p>A <code>rule</code> is a check that <code>sonar</code> will validate. The API should be flexible enough to allow you to implement anything you want easily:</p><ul><li>Validate that all links are <code>HTTPS</code>.</li><li>Integrate with a third party service.</li><li>Inject JavaScript to execute in the context of the page.</li><li>etc.</li></ul><p>If there is something you want to do and you can’t, or it is not clear how to do it, please open an issue.</p><h2 id="typesofrules">Types of rules<a href="#typesofrules" class="headerlink" title="Types of rules"></a></h2><p>There are 2 types of <code>rule</code>s a user can develop:</p><ul><li><code>external</code>: These are <code>rule</code>s that are published independently. When a <code>rule</code> is specific to a domain or use case, it should be external.</li><li><code>core</code>: These are the <code>rule</code>s that are shipped with <code>sonar</code> directly. Before starting to develop a <code>core rule</code>, please make sure there is an open issue and talk with the maintainers about it.</li></ul><p>Both types of <code>rule</code>s <a href="#howruleswork">work exactly the same</a>, the only difference being where they are located.</p><h3 id="creatinganexternalrule">Creating an external rule<a href="#creatinganexternalrule" class="headerlink" title="Creating an external rule"></a></h3><p>The easiest wait to create a new rule that will be distributed outside <code>sonar</code> is via the CLI parameter <code>--new-rule</code>. You have 2 options:</p><ul><li>Using <code>sonar</code> as a global package:</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm install -g --engine-strict @sonarwhal/sonar</div><div class="line">sonar --new-rule</div></pre></td></tr></table></figure><ul><li><p>Using <code>npx</code> if you don’t want to install it globally:</p><p><strong>Windows users:</strong> Currently <a href="https://github.com/npm/npm/issues/17869" target="_blank" rel="noopener noreferrer external"><code>npx</code> has an issue in this platform</a> and the command will not work.</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npx @sonarwhal/sonar --new-rule</div></pre></td></tr></table></figure><p>In both cases, a wizard will start and ask you a series of questions:</p><ul><li>What’s the name of this rule?</li><li>What’s the description of this rule?</li></ul><p>Once answered, it will create a new directory with the name of the rule and the right infrastructure to get you started. You just have to run <code>npm install</code> in there to get all the dependencies and start working. Tests will be already configured to use the same infrastructure as the core rules.</p><h3 id="workingwithcorerules">Working with core rules<a href="#workingwithcorerules" class="headerlink" title="Working with core rules"></a></h3><h4 id="creatingacorerule">Creating a core rule<a href="#creatingacorerule" class="headerlink" title="Creating a core rule"></a></h4><p>If you are working in <code>sonar</code>‘s main repository, one of the easiest ways to get started is to use <code>sonar</code>‘s CLI, which helps to generate the template files and insert them at the right location.</p><p>First you need to install the CLI:</p><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm install -g --engine-strict @sonarwhal/sonar</div></pre></td></tr></table></figure><p>You can also install it as a <code>devDependency</code> if you prefer not to have it globally.</p><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">npm install -D --engine-strict @sonarwhal/sonar</div></pre></td></tr></table></figure><p>Then you can proceed to start generating a new rule using the flag <code>--new-rule</code>:</p><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">sonar --new-rule</div></pre></td></tr></table></figure><p>This command will start a wizard that will ask you a series of questions related to this new rule. A complete list of the questions is shown below:</p><ul><li>What’s the name of this new rule?</li><li>Please select the category of this new rule:<ul><li>accessibility</li><li>interoperability</li><li>performance</li><li>pwa</li><li>security</li></ul></li><li>What’s the description of this new rule?</li><li>Please select the category of use case:<ul><li>DOM<ul><li>What DOM element does the rule need access to?</li></ul></li><li>Resource Request</li><li>Third Party Service</li><li>JS injection</li></ul></li></ul><p>Answer these questions and you will end up with a template rule file. Events determined to be relevant to this use case will be subscribed to automatically in the script. If this is a core rule, templates for documentation and tests will be generated, with the <a href="../../user-guide/rules/">rule index page</a> under <code>user guide</code> updated to include the new rule item.</p><h4 id="removeacorerulefromcli">Remove a core rule from CLI<a href="#removeacorerulefromcli" class="headerlink" title="Remove a core rule from CLI"></a></h4><p>Similarly, you can also use CLI to remove an existing rule by using the flag <code>--remove-rule</code>:</p><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">sonar --remove-rule</div></pre></td></tr></table></figure><p>You will be asked to type in the normalized name of the rule, and all files associated with this rule (script, documentation, and tests) will be removed.</p><h2 id="howruleswork">How rules work<a href="#howruleswork" class="headerlink" title="How rules work"></a></h2><p>The following is a basic template for a rule (<code>import</code> paths might change depending on the rule type):</p><figure class="highlight ts"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; Category &#125; <span class="keyword">from</span> <span class="string">'../../enums/category'</span>;</div><div class="line"><span class="keyword">import</span> &#123; IFetchEnd, IRule, IRuleBuilder &#125; <span class="keyword">from</span> <span class="string">'../../types'</span>;</div><div class="line"><span class="keyword">import</span> &#123; RuleContext &#125; <span class="keyword">from</span> <span class="string">'../../rule-context'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> rule: IRuleBuilder = &#123;</div><div class="line">    create(context: RuleContext): IRule &#123;</div><div class="line">        <span class="comment">// Your code here.</span></div><div class="line"></div><div class="line">        <span class="keyword">const</span> validateFetchEnd = <span class="function">(<span class="params">fetchEnd: IFetchEnd</span>) =&gt;</span> &#123;</div><div class="line">            <span class="comment">// Code to validate the rule on the event fetch::end.</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">const</span> validateTargetFetchEnd = <span class="function">(<span class="params">targetFetchEnd: IFetchEnd</span>) =&gt;</span> &#123;</div><div class="line">            <span class="comment">// Code to validate the rule on the event targetfetch::end.</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">const</span> validateElement = <span class="function">(<span class="params">element: IElementFound</span>) =&gt;</span> &#123;</div><div class="line">            <span class="comment">// Code to validate the rule on the event element::element-type.</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">          <span class="string">'element'</span>: validateElement,</div><div class="line">          <span class="string">'fetch::end'</span>: validateFetchEnd,</div><div class="line">          <span class="string">'targetfetch::end'</span>: validateTargetFetchEnd</div><div class="line">          <span class="comment">// As many events as you need, you can see the</span></div><div class="line">          <span class="comment">// list of events [here](../connectors/events/).</span></div><div class="line">      &#125;;</div><div class="line">    &#125;,</div><div class="line">    meta: &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Rules are executed via <a href="../connectors/events/">events</a>. There are several events exposed by the connectors. The way to indicate which ones the rule cares about is via the method <code>create</code>. This method returns an objects whose keys are the names of the events and the values the event handlers:</p><figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"eventName1"</span>: <span class="string">"eventHandler1"</span>,</div><div class="line">    <span class="attr">"eventName2"</span>: <span class="string">"eventHandler2"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>There is no limit in the number of events a rule can listen to, but you want to keep it as simple as possible.</p><p>Rule constructors receive a <code>context</code> object that makes it easier to interact with the website and report errors.</p><p>To report an error, the rule has to do the following:</p><figure class="highlight ts"><table><tr><td class="code"><pre><div class="line"><span class="keyword">await</span> context.report(resource, element, message);</div></pre></td></tr></table></figure><ul><li><code>context.report()</code> is an asynchronous method, you should always <code>await</code>.</li><li><code>resource</code> is the URL of what is being analyzed (HTML, JS, CSS, manifest, etc.)</li><li><code>element</code> is the <code>IAsyncHTMLElement</code> that triggered the problem. Not always necessary. In the case of an image, script, style, it will be an <code>img</code>, <code>script</code>, <code>link</code>, etc.</li></ul><p>On top or reporting errors, the <code>context</code> object exposes more information to enable more complex scenarios. Some of the following sections describe them.</p><h3 id="themetaproperty">The <code>meta</code> property<a href="#themetaproperty" class="headerlink" title="The meta property"></a></h3><p>Rules have an object <code>meta</code> that defines several properties:</p><figure class="highlight"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"docs"</span>: &#123;</div><div class="line">        <span class="attr">"category"</span>: <span class="string">"Category"</span>,</div><div class="line">        <span class="attr">"description"</span>: <span class="string">"string"</span></div><div class="line">    &#125;,</div><div class="line">    "recommended": "boolean", // If the rule is part of the recommended options</div><div class="line">    "schema": ["json schema"], // An array of valid JSON schemas</div><div class="line">    "worksWithLocalFiles": "boolean" // If the rule works with `file://`</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>One of the most useful properties is <code>schema</code>. This property specifies if the rule allows the user to configure it (other than the severity). By default it should be an empty array if it doesn’t, or an array of valid <a href="http://json-schema.org/" target="_blank" rel="noopener noreferrer external">JSON schemas</a>. These schemas will be used when validating a <code>.sonarrc</code> file. As long as there is one of the schemas that passes, the configuration will be valid. This allows writting simpler templates.</p><p>The rule can access the custom configuration via <code>context.ruleOptions</code>.</p><h3 id="changefeedbackbasedonbrowsersupport">Change feedback based on browser support<a href="#changefeedbackbasedonbrowsersupport" class="headerlink" title="Change feedback based on browser support"></a></h3><p>Users can tell <code>sonar</code> what browsers are important for them via the <a href="../../user-guide/index.md#browserconfiguration"><code>browserslist</code> property in <code>.sonarrc</code></a>. You can have access to the list, and thus modify the feedback of your rule, via the property <code>context.targetedBrowsers</code>.</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> validate = <span class="function">(<span class="params">fetchEnd</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">if</span> (!context.targetedBrowsers.includes(<span class="string">'Edge 14'</span>)) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Your validations</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure><h3 id="reportinganerrorifnotrun">Reporting an error if not run<a href="#reportinganerrorifnotrun" class="headerlink" title="Reporting an error if not run"></a></h3><p>Sometimes what a rule checks is mandatory, and if it does not have the change to test it, it should fail. These are the types of rules that enforce certain things to be used in a certain way, and if included, in order for the rule to pass, the expectation should be that the thing the rule checks for should exist and be valid/used correctly. Examples here are the rules that check for different fields of the manifest file. They should not pass if, for example, the web manifest file doesn’t exist (even if there is a rule that checks exactly that).</p><p>The recommended way to implement a rule like this is to subscribe to the event <code>scan::end</code>. If your rule receives that event and has not run any validation you should report it.</p><h3 id="evaluatejavascriptinthepagecontext">Evaluate JavaScript in the page context<a href="#evaluatejavascriptinthepagecontext" class="headerlink" title="Evaluate JavaScript in the page context"></a></h3><p>Sometimes a rule needs to evaluate some JavaScript in the context of the page. To do that you need to use <code>context.evaluate</code>. This method will always return a <code>Promise</code> even if your code does not return one.</p><p>One important thing is that your code needs to be wrapped in an immediate invoked function expression (IIFE)</p><p>The following scripts will work:</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> script =</div><div class="line"><span class="string">`(function() &#123;</span></div><div class="line"><span class="string">    return true;</span></div><div class="line"><span class="string">&#125;())`</span>;</div><div class="line"></div><div class="line">context.evaluate(script);</div></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> script =</div><div class="line"><span class="string">`(function() &#123;</span></div><div class="line"><span class="string">    return Promise.resolve(true);</span></div><div class="line"><span class="string">&#125;())`</span>;</div><div class="line"></div><div class="line">context.evaluate(script);</div></pre></td></tr></table></figure><p>The following does not:</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> script = <span class="string">`return true;`</span>;</div><div class="line"></div><div class="line">context.evaluate(script);</div></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> script = <span class="string">`return Promise.resolve(true);`</span>;</div><div class="line"></div><div class="line">context.evaluate(script);</div></pre></td></tr></table></figure><h3 id="ignoreconnectors">Ignore connectors<a href="#ignoreconnectors" class="headerlink" title="Ignore connectors"></a></h3><p>If your rule does not work propertly with certain connectors you can use the property <code>ignoreConnectors</code> so it is not run if using them.</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> rule = &#123;</div><div class="line">    create(context) &#123;</div><div class="line">        <span class="comment">// Your code here</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    meta: &#123;</div><div class="line">        ignoredConnectors: [<span class="string">'jsdom'</span>]</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><h3 id="interactwithotherservices">Interact with other services<a href="#interactwithotherservices" class="headerlink" title="Interact with other services"></a></h3><p>You can develop a rule that integrates with other services. <code>sonar</code> integrates with a few like <code>ssllabs</code>.</p><p>Because these online tools usually take a few seconds to return the results the guidance is to start the analysis as soon as possible and then collect the results as late as possible. This means you will have to listen to <code>scan::start</code> and <code>scan::end</code> events respectively. The <code>create</code> method of your rule should be similar to the following:</p><figure class="highlight ts"><table><tr><td class="code"><pre><div class="line">create(context: RuleContext): IRule &#123;</div><div class="line">    <span class="comment">/** The promise that represents the connection to the online service. */</span></div><div class="line">    <span class="keyword">let</span> promise: <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> start = <span class="function">(<span class="params">data: IScanStartEvent</span>) =&gt;</span> &#123;</div><div class="line">        <span class="comment">// Initialize promise to service here but do not return it.</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> end = (data: IScanEndEvent): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt; =&gt; &#123;</div><div class="line">        <span class="keyword">return</span> promise</div><div class="line">            .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</div><div class="line">                <span class="comment">// Report any results via `context.report` here.</span></div><div class="line">            &#125;)</div><div class="line">            .catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">                <span class="comment">// Always good to handle errors.</span></div><div class="line">            &#125;);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="string">'scan::start'</span>: start,</div><div class="line">        <span class="string">'scan::end'</span>: end</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>In case you need a more complete example, please look at the <code>ssllabs.ts</code> source code.</p><h2 id="howtotestarule">How to test a rule<a href="#howtotestarule" class="headerlink" title="How to test a rule"></a></h2><p>If you have used the built-in tools to create a new rule (internal or external), everything should already set up to use <code>rule-runner.ts</code> and the <code>testRule</code> method.</p><p>If not, you just need to:</p><ol><li>Create a <code>tests.ts</code> file in a folder with the name of the rule (e.g.: <code>src/tests/rules/&lt;rule-id&gt;/tests.ts</code>)</li><li>Have the following template:</li></ol><figure class="highlight ts"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; RuleTest &#125; <span class="keyword">from</span> <span class="string">'../../../helpers/rule-test-type'</span>; <span class="comment">// eslint-disable-line no-unused-vars</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ruleRunner <span class="keyword">from</span> <span class="string">'../../../helpers/rule-runner'</span>;</div><div class="line"><span class="keyword">import</span> &#123; getRuleName &#125; <span class="keyword">from</span> <span class="string">'../../../../src/lib/utils/rule-helpers'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> ruleName = getRuleName(__dirname);</div><div class="line"></div><div class="line"><span class="keyword">const</span> tests: <span class="built_in">Array</span>&lt;RuleTest&gt; = [</div><div class="line">    &#123;</div><div class="line">        name: <span class="string">'Name of the tests'</span>,</div><div class="line">        serverConfig: <span class="string">'HTML to use'</span>,</div><div class="line">        reports: [&#123;</div><div class="line">            message: <span class="string">'Message the error will have'</span>,</div><div class="line">            position: &#123; column: <span class="number">0</span>, line: <span class="number">0</span> &#125; <span class="comment">// Where the error will show.</span></div><div class="line">        &#125;]</div><div class="line">    &#125;,</div><div class="line">    &#123; ... &#125;</div><div class="line">];</div><div class="line"></div><div class="line">ruleRunner.testRule(ruleName, tests);</div></pre></td></tr></table></figure><h3 id="testrule">testRule()<a href="#testrule" class="headerlink" title="testRule()"></a></h3><p>The signature of <code>ruleRunner.testRule</code> is:</p><ul><li><code>ruleName</code>, the name of the rule.</li><li><code>tests</code>, an <code>Array&lt;RuleTest&gt;</code>.</li><li><code>ruleConfig</code>, (optional) to modify the defaults of the rule.</li><li><code>serial</code>, (optional, defaults to <code>false</code>) to run the tests of that rule serially.</li></ul><p><code>serverConfig</code> can be of different types depending on particular needs:</p><ul><li><code>string</code> containing the response for <code>/</code> (HTML, plain text, etc.).</li><li><code>object</code> with paths as properties names and their content as values:</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> serverConfig = &#123;</div><div class="line">    <span class="string">'/'</span>: <span class="string">'some HTML here'</span>,</div><div class="line">    <span class="string">'site.webmanifest'</span>: <span class="string">'other content'</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>You can even specify the headers and status code for the response for a specific path, by using the <code>headers</code> and <code>status</code> properties:</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> serverConfig = &#123;</div><div class="line">    <span class="string">'/'</span>: <span class="string">'page content goes here...'</span>,</div><div class="line">    <span class="string">'/example.js'</span>: &#123;</div><div class="line">        content: <span class="string">'script content goes here...'</span>,</div><div class="line">        headers: &#123;</div><div class="line">            <span class="string">'Content-Type'</span>: <span class="string">'text/javascript; charset=utf-8'</span>,</div><div class="line">            Header: <span class="string">'value'</span></div><div class="line">            <span class="comment">// ...</span></div><div class="line">        &#125;,</div><div class="line">        status: statusCode</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>Notes:</p><ul><li>If <code>content</code> is not specified, it will default to an empty string <code>&#39;&#39;</code>.</li><li>To remove any of the default HTTP response headers, just set their value to <code>null</code> (e.g.: <code>headers: { &#39;&lt;response_header&gt;&#39;: null }</code>).</li><li><code>status</code> defaults to <code>200</code>, so it only needs to be specified if its value is different.</li></ul><p><code>rule-runner</code> will automatically test the rule in all the supported connectors.</p><h3 id="throwinganerror">Throwing an error<a href="#throwinganerror" class="headerlink" title="Throwing an error"></a></h3><p>If you need to force an error in the <code>connector</code> when visiting a URL you just have to make the content <code>null</code>. This will force a redirect to <code>test://fail</code>, thus, causing an exception.</p><h3 id="testinganexternalurl">Testing an external URL<a href="#testinganexternalurl" class="headerlink" title="Testing an external URL"></a></h3><p>If you need to test an external resource (because you are integrating with a third party service) you need to use the property <code>serverUrl</code>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> tests: <span class="built_in">Array</span>&lt;RuleTest&gt; = [</div><div class="line">    &#123;</div><div class="line">        name: <span class="string">'Name of the tests'</span>,</div><div class="line">        serverUrl: <span class="string">'https://example.com'</span>,</div><div class="line">        reports: [&#123;</div><div class="line">            message: <span class="string">'Message the error will have'</span></div><div class="line">        &#125;]</div><div class="line">    &#125;,</div><div class="line">    &#123; ... &#125;</div><div class="line">];</div></pre></td></tr></table></figure><h3 id="executecodebeforeoraftercollectingtheresults">Execute code <code>before</code> or <code>after</code> collecting the results<a href="#executecodebeforeoraftercollectingtheresults" class="headerlink" title="Execute code before or after collecting the results"></a></h3><p>In some scenarios you need to execute some code <code>before</code> or <code>after</code> the actual tests (e.g.: if you need to mock a dependency). For those cases you can use the <code>before</code> and <code>after</code> properties of <code>RuleTest</code>:</p><figure class="highlight ts"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> tests: <span class="built_in">Array</span>&lt;RuleTest&gt; = [</div><div class="line">    &#123;</div><div class="line">        after() &#123;</div><div class="line">            <span class="comment">// Code to execute right before calling `connector.close` goes here.</span></div><div class="line">        &#125;</div><div class="line">        before() &#123;</div><div class="line">            <span class="comment">// Code to execute before the creation of the sonar object here.</span></div><div class="line">        &#125;,</div><div class="line">        name: <span class="string">'Name of the tests'</span>,</div><div class="line">        serverUrl: <span class="string">'https://example.com'</span>,</div><div class="line">        reports: [&#123;</div><div class="line">            message: <span class="string">'Message the error will have'</span></div><div class="line">        &#125;]</div><div class="line">    &#125;,</div><div class="line">    &#123; ... &#125;</div><div class="line">];</div></pre></td></tr></table></figure></div><div class="module module--secondary table-of-contents treeview" role="navigation"><ul role="tree" aria-labelledby="page-heading" tabindex="0"><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="false"><div class="toc-section-title"><span class="text">connectors</span> <span class="icon"></span></div><ul role="group"><li role="treeitem"><div class="toc-subsection-title"><a class="text" href="/docs/contributor-guide/connectors/" tabindex="-1">How to develop a connector</a></div></li><li role="treeitem"><div class="toc-subsection-title"><a class="text" href="/docs/contributor-guide/connectors/events/" tabindex="-1">Events</a></div></li></ul></li><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="false"><div class="toc-section-title"><span class="text">contributing</span> <span class="icon"></span></div><ul role="group"><li role="treeitem"><div class="toc-subsection-title"><a class="text" href="/docs/contributor-guide/contributing/pull-requests/" tabindex="-1">Pull Requests</a></div></li></ul></li><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="false"><div class="toc-section-title"><span class="text">formatters</span> <span class="icon"></span></div><ul role="group"><li role="treeitem"><div class="toc-subsection-title"><a class="text" href="/docs/contributor-guide/formatters/" tabindex="-1">How to develop a formatter</a></div></li></ul></li><li role="treeitem" aria-label="subsection" tabindex="0" aria-expanded="true"><div class="toc-section-title--active"><span class="text">rules</span> <span class="icon"></span></div><ul role="group"><li role="treeitem" aria-selected="true"><div class="toc-subsection-title--active" aria-current="location"><a class="text" href="/docs/contributor-guide/rules/">How to develop a rule</a></div></li></ul></li></ul></div></div></div></article></main><footer class="footer footer--home"><div class="footer-nav container"><div class="footer-nav__item"><p class="category"><a href="/scanner/">Scanner</a></p><ul></ul></div><div class="footer-nav__item"><p class="category"><a href="/docs/">Documentation</a></p><ul><li><a href="/docs/contributor-guide/">Contributor Guide</a></li><li><a href="/docs/user-guide/rules/">Rules</a></li><li><a href="/docs/user-guide/">User Guide</a></li></ul></div><div class="footer-nav__item"><p class="category"><a href="/about/">About</a></p><ul><li><a href="/about/faq/">FAQ</a></li><li><a href="/about/changelog/">Changelog</a></li><li><a href="/about/governance/">Governance</a></li><li><a href="/about/contributors/">Contributors</a></li><li><a href="https://js.foundation/community/code-of-conduct">Code of Conduct</a></li></ul></div><ul class="footer-nav__item social-list"><li class="github-icon"><a href="https://github.com/sonarwhal" aria-label="Follow Sonar on GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25"><path class="github-icon-svg" d="M12.5.4C5.7.4.2 5.9.2 12.7c0 5.4 3.5 10 8.4 11.7.6.1.8-.3.8-.6v-2.1C6 22.4 5.3 20 5.3 20c-.6-1.4-1.4-1.8-1.4-1.8-1.1-.7.1-.7.1-.7 1.2.1 1.9 1.3 1.9 1.3 1.1 1.9 2.9 1.3 3.6 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.6-1.4-5.6-6.1 0-1.3.5-2.4 1.3-3.3-.2-.4-.6-1.6 0-3.3 0 0 1-.3 3.4 1.3 1-.3 2-.4 3.1-.4 1 0 2.1.1 3.1.4C17.9 5.2 19 5.5 19 5.5c.7 1.7.2 2.9.1 3.3.8.9 1.3 2 1.3 3.3 0 4.7-2.9 5.8-5.6 6.1.4.4.8 1.1.8 2.3v3.4c0 .3.2.7.8.6 4.9-1.6 8.4-6.2 8.4-11.7C24.8 5.9 19.3.4 12.5.4"/></svg></a></li><li class="twitter-icon"><a href="https://twitter.com/narwhalnellie" aria-label="Follow Sonar on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 24"><path class="twitter-icon-svg" d="M25 4.4c-.9.4-1.9.7-2.9.8 1-.6 1.8-1.6 2.2-2.8-1 .6-2.1 1-3.2 1.2-.9-1-2.2-1.6-3.7-1.6-2.8 0-5 2.3-5 5 0 .4 0 .8.1 1.2C8.3 8 4.6 6 2.1 2.9c-.4.8-.7 1.6-.7 2.6 0 1.8.9 3.3 2.2 4.2-.8-.1-1.5-.3-2.2-.7v.1c0 2.4 1.7 4.5 4.1 5-.4.1-.9.2-1.3.2-.3 0-.6 0-.9-.1.6 2 2.5 3.5 4.7 3.5-1.9 1.3-4 2.1-6.4 2.1-.4 0-.8 0-1.2-.1C2.6 21.2 5.3 22 8.1 22c9.3 0 14.4-7.7 14.4-14.4v-.7c1-.6 1.8-1.5 2.5-2.5"/></svg></a></li></ul></div></footer><script async src="/components/treeview/treeview.js"></script><script async src="/js/nav.js"></script><script async src="/core/scripts/form-validation.js"></script><script async src="/components/accordion/accordion.js"></script><script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>!function(){var e,o=docsearch({apiKey:"2ee58f908e6d720c4f72a9645ce0e857",indexName:"sonarwhal",inputSelector:"#search-input",appId:"0R8E5SPAFP",debug:!1,handleSelected:function(o,t,n){window.innerWidth<e?t.target.closest("form").submit():window.location.href=n.url}}),t=document.querySelector(".algolia-autocomplete .ds-dropdown-menu");e=parseInt(window.getComputedStyle(t).minWidth),o.autocomplete.on("autocomplete:opened",function(){document.body.clientWidth<e&&o.autocomplete.autocomplete.close()})}()</script><script>!function(e,t,a,c,n){e.GoogleAnalyticsObject=a,e[a]||(e[a]=function(){(e[a].q=e[a].q||[]).push(arguments)}),e[a].l=+new Date,c=t.createElement("script"),n=t.scripts[0],c.src="https://www.google-analytics.com/analytics.js",n.parentNode.insertBefore(c,n)}(this,document,"ga"),ga("create","UA-101540923-1"),ga("send","pageview")</script></body></html>